{
  "IFRET": {
    "description": {
      "short": "",
      "long": "Performs a `RET`, but only if integer `cond` is non-zero. If `cond` is a `NaN`, throws an integer overflow exception.",
      "tags": [],
      "operands": []
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          }
        ],
        "registers": [
          {
            "type": "constant",
            "index": 0
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "register",
          "index": 0
        }
      ]
    }
  },
  "IFNOTRET": {
    "description": {
      "short": "",
      "long": "Performs a `RET`, but only if integer `cond` is zero.",
      "tags": [],
      "operands": []
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          }
        ],
        "registers": [
          {
            "type": "constant",
            "index": 0
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "register",
          "index": 0
        }
      ]
    }
  },
  "IF": {
    "description": {
      "short": "",
      "long": "Performs `EXECUTE` for `body` (i.e., _executes_ `body`), but only if integer `cond` is non-zero. Otherwise simply discards both values.",
      "tags": [],
      "operands": [],
      "examples": [
        {
          "instructions": [
            {
              "instruction": "PUSHINT_4 1",
              "comment": "Condition value (non-zero means true)"
            },
            {
              "instruction": "PUSHCONT {\n  PUSHINT_4 10\n  PUSHINT_4 20\n  ADD\n}",
              "comment": "Continuation body that adds 10 and 20"
            },
            {
              "instruction": "IF",
              "comment": "Execute the continuation if condition is true"
            }
          ],
          "stack": {
            "input": ["1", "Continuation"],
            "output": ["30"]
          }
        },
        {
          "instructions": [
            {
              "instruction": "PUSHINT_4 0",
              "comment": "Condition value (zero means false)"
            },
            {
              "instruction": "PUSHCONT {\n  PUSHINT_4 10\n  PUSHINT_4 20\n  ADD\n}",
              "comment": "Continuation body that adds 10 and 20"
            },
            {
              "instruction": "IF",
              "comment": "Execute the continuation if condition is true"
            }
          ],
          "stack": {
            "input": ["0", "Continuation"],
            "output": []
          }
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "body",
            "value_types": ["Continuation"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        }
      ]
    }
  },
  "IFNOT": {
    "description": {
      "short": "",
      "long": "Executes continuation `body`, but only if integer `cond` is zero. Otherwise simply discards both values.",
      "tags": [],
      "operands": []
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "body",
            "value_types": ["Continuation"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        }
      ]
    }
  },
  "IFJMP": {
    "description": {
      "short": "",
      "long": "Transfers control to `body` if `cond` is non-zero. The remainder of the current continuation is discarded which means that after `body` completes, control will not return to instruction immediately following the `IFJMP`. Instead, it will return to the instruction immediately following the instruction that started current continuation. If such continuation is not present, the program will exit.",
      "tags": ["control_flow"],
      "operands": [],
      "examples": [
        {
          "instructions": [
            {
              "instruction": "PUSHCONT [\n  PUSHINT_4 1\n  PUSHINT_4 2\n  ADD\n  // implicit exit from the continuation\n  // and since there is no grand continuation\n  // the program will exit\n]",
              "is_main": true
            },
            {
              "instruction": "PUSHINT 1"
            },
            {
              "instruction": "IFJMP",
              "comment": "Transfers control to the continuation",
              "is_main": true
            },
            {
              "instruction": "PUSHINT_LONG 999",
              "comment": "This will never be executed"
            }
          ],
          "stack": {
            "input": ["Continuation", "1"],
            "output": []
          }
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "body",
            "value_types": ["Continuation"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c"
        }
      ]
    }
  },
  "IFNOTJMP": {
    "description": {
      "short": "",
      "long": "Transfers control to `body` if `cond` is zero. The remainder of the current continuation is discarded which means that after `body` completes, control will not return to instruction immediately following the `IFJMP`. Instead, it will return to the instruction immediately following the instruction that started current continuation. If such continuation is not present, the program will exit.",
      "tags": [],
      "operands": []
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "body",
            "value_types": ["Continuation"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c"
        }
      ]
    }
  },
  "IFELSE": {
    "description": {
      "short": "",
      "long": "If integer `cond` is non-zero, executes `body`, otherwise executes `else`",
      "tags": [],
      "operands": [],
      "other_implementations": [
        {
          "exact": true,
          "instructions": ["CONDSELCHK", "EXECUTE"]
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "body",
            "value_types": ["Continuation"]
          },
          {
            "type": "simple",
            "name": "else",
            "value_types": ["Continuation"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        },
        {
          "type": "variable",
          "var_name": "c2",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        }
      ]
    }
  },
  "CONDSEL": {
    "description": {
      "short": "",
      "long": "If integer `f` is non-zero, returns `x`, otherwise returns `y`. Notice that no type checks are performed on `x` and `y`, so, it is more like a conditional stack operation.",
      "tags": [],
      "operands": [],
      "other_implementations": [
        {
          "exact": false,
          "instructions": ["ROT", "ISZERO", "INC", "ROLLX", "NIP"]
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "x"
          },
          {
            "type": "simple",
            "name": "y"
          }
        ]
      },
      "outputs": {
        "stack": [
          {
            "type": "simple",
            "name": "result"
          }
        ]
      }
    }
  },
  "CONDSELCHK": {
    "description": {
      "short": "",
      "long": "If integer `f` is non-zero, returns `x`, otherwise returns `y`. Unlike `CONDSEL` this instruction checks whether `x` and `y` have the same type.",
      "tags": [],
      "operands": []
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "x"
          },
          {
            "type": "simple",
            "name": "y"
          }
        ]
      },
      "outputs": {
        "stack": [
          {
            "type": "simple",
            "name": "result"
          }
        ]
      }
    }
  },
  "IFRETALT": {
    "description": {
      "short": "",
      "long": "Performs `RETALT` if integer `cond != 0`.",
      "tags": [],
      "operands": []
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          }
        ],
        "registers": [
          {
            "type": "constant",
            "index": 1
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "register",
          "index": 1
        }
      ]
    }
  },
  "IFNOTRETALT": {
    "description": {
      "short": "",
      "long": "Performs `RETALT` if integer `cond == 0`.",
      "tags": [],
      "operands": []
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          }
        ],
        "registers": [
          {
            "type": "constant",
            "index": 1
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "register",
          "index": 1
        }
      ]
    }
  },
  "IFBITJMP": {
    "description": {
      "short": "",
      "long": "Checks whether `i`-th bit is set in integer `x`, and if so, performs `JMPX` to continuation `body`. Value `x` is left in the stack.",
      "tags": [],
      "operands": ["i"]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "x",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "body",
            "value_types": ["Continuation"]
          }
        ]
      },
      "outputs": {
        "stack": [
          {
            "type": "simple",
            "name": "x",
            "value_types": ["Int"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c"
        }
      ]
    }
  },
  "IFNBITJMP": {
    "description": {
      "short": "",
      "long": "Checks whether `i`-th bit is NOT set in integer `x`, and if so, performs `JMPX` to continuation `body`. Value `x` is left in the stack.",
      "tags": [],
      "operands": ["i"]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "x",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "body",
            "value_types": ["Continuation"]
          }
        ]
      },
      "outputs": {
        "stack": [
          {
            "type": "simple",
            "name": "x",
            "value_types": ["Int"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c"
        }
      ]
    }
  },
  "IFREF": {
    "description": {
      "short": "",
      "long": "Executes the continuation stored in cell reference `body` if integer `cond` is non-zero. Optimized so that the cell reference is not actually loaded into a _Slice_ and then converted into an ordinary _Continuation_ if `cond == 0`.\nGas consumption of this primitive depends on whether `cond == 0` and whether the reference was loaded before.\nSimilar remarks apply other primitives that accept a continuation as a reference.",
      "tags": [],
      "operands": ["body"],
      "other_implementations": [
        {
          "exact": false,
          "instructions": ["PUSHREFCONT", "IF"]
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        }
      ]
    }
  },
  "IFNOTREF": {
    "description": {
      "short": "",
      "long": "Executes the continuation stored in cell reference `body`, but only if integer `cond` is zero.",
      "tags": [],
      "operands": ["body"],
      "other_implementations": [
        {
          "exact": true,
          "instructions": ["PUSHREFCONT", "IFNOT"]
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        }
      ]
    }
  },
  "IFJMPREF": {
    "description": {
      "short": "",
      "long": "Transfers control to the continuation stored in cell reference `body` if `cond` is non-zero. The remainder of the current continuation is discarded which means that after `body` completes, control will not return to instruction immediately following the `IFJMPREF`. Instead, it will return to the instruction immediately following the instruction that started current continuation. If such continuation is not present, the program will exit.",
      "tags": [],
      "operands": ["body"],
      "other_implementations": [
        {
          "exact": true,
          "instructions": ["PUSHREFCONT", "IFJMP"]
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c"
        }
      ]
    }
  },
  "IFNOTJMPREF": {
    "description": {
      "short": "",
      "long": "Transfers control to the continuation stored in cell reference `body` if `cond` is zero.",
      "tags": [],
      "operands": ["body"],
      "other_implementations": [
        {
          "exact": true,
          "instructions": ["PUSHREFCONT", "IFNOTJMP"]
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c"
        }
      ]
    }
  },
  "IFREFELSE": {
    "description": {
      "short": "",
      "long": "If integer `cond` is non-zero, executes the continuation stored in cell reference `c`, otherwise executes `else`. When `cond` is zero, optimized to skip loading the cell reference for body into a _Slice_ and converting it to an ordinary _Continuation_.",
      "tags": [],
      "operands": ["c"],
      "other_implementations": [
        {
          "exact": false,
          "instructions": ["PUSHREFCONT", "SWAP", "IFELSE"]
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "body",
            "value_types": ["Continuation"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        },
        {
          "type": "variable",
          "var_name": "c2",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        }
      ]
    }
  },
  "IFELSEREF": {
    "description": {
      "short": "",
      "long": "If integer `cond` is non-zero, executes `body`, otherwise executes the continuation stored in cell reference `c`. When `cond` is non-zero, optimized to skip loading the cell reference for else branch into a _Slice_ and converting it to an ordinary _Continuation_.",
      "tags": [],
      "operands": ["c"],
      "other_implementations": [
        {
          "exact": true,
          "instructions": ["PUSHREFCONT", "IFELSE"]
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          },
          {
            "type": "simple",
            "name": "body",
            "value_types": ["Continuation"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        },
        {
          "type": "variable",
          "var_name": "c2",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        }
      ]
    }
  },
  "IFREFELSEREF": {
    "description": {
      "short": "",
      "long": "If integer `cond` is non-zero, executes the continuation stored in cell reference `body`, otherwise executes the continuation stored in cell reference `else`.",
      "tags": [],
      "operands": ["body", "else"],
      "other_implementations": [
        {
          "exact": true,
          "instructions": ["PUSHREFCONT", "PUSHREFCONT", "IFELSE"]
        }
      ]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "cond",
            "value_types": ["Int"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c1",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        },
        {
          "type": "variable",
          "var_name": "c2",
          "save": {
            "c0": {
              "type": "cc",
              "save": {
                "c0": {
                  "type": "register",
                  "index": 0
                }
              }
            }
          }
        }
      ]
    }
  },
  "IFBITJMPREF": {
    "description": {
      "short": "",
      "long": "Performs a `JMPREF` if `i`-th bit is set in integer `x`. Value `x` is left in the stack.",
      "tags": [],
      "operands": ["i", "body"]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "x",
            "value_types": ["Int"]
          }
        ]
      },
      "outputs": {
        "stack": [
          {
            "type": "simple",
            "name": "x",
            "value_types": ["Int"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c"
        }
      ]
    }
  },
  "IFNBITJMPREF": {
    "description": {
      "short": "",
      "long": "Performs a `JMPREF` if `i`-th bit is NOT set in integer `x`. Value `x` is left in the stack.",
      "tags": [],
      "operands": ["i", "body"]
    },
    "signature": {
      "inputs": {
        "stack": [
          {
            "type": "simple",
            "name": "x",
            "value_types": ["Int"]
          }
        ]
      },
      "outputs": {
        "stack": [
          {
            "type": "simple",
            "name": "x",
            "value_types": ["Int"]
          }
        ]
      }
    },
    "control_flow": {
      "branches": [
        {
          "type": "variable",
          "var_name": "c"
        }
      ]
    }
  }
}
